cmake_minimum_required(VERSION 3.12)

add_subdirectory(avir)
add_subdirectory(bvh)
add_subdirectory(Catch2)
add_subdirectory(cista)
add_subdirectory(cy)
add_subdirectory(cxxopts-3.1.1)
add_subdirectory(dxc)
add_subdirectory(eigen-3.4.0)
add_subdirectory(fmt)
#add_subdirectory(geometry-central)
add_subdirectory(glfw)
add_subdirectory(half)
add_subdirectory(imgui)
add_subdirectory(json)
add_subdirectory(magic_enum-0.9.5)
add_subdirectory(mimalloc)
add_subdirectory(ryu)
add_subdirectory(sigslot)
add_subdirectory(SPIRV-REFLECT)
add_subdirectory(spdlog-1.12.0)
add_subdirectory(smhasher)
add_subdirectory(stb)
add_subdirectory(tbbinterface)
add_subdirectory(tinyexr)
add_subdirectory(tinyobjloader)
add_subdirectory(unordered_dense)

add_library(libigl INTERFACE)
target_include_directories(libigl INTERFACE "${CMAKE_CURRENT_SOURCE_DIR}/libigl-2.5.0/include")
target_link_libraries(libigl INTERFACE Eigen3::Eigen)

if(RTRC_ENABLE_VULKAN_BACKEND)
    add_subdirectory(volk)
    add_subdirectory(vk-bootstrap)
    add_subdirectory(VulkanMemoryAllocator)
endif()

if(RTRC_ENABLE_DIRECTX12_BACKEND)
    add_subdirectory(microsoft.direct3d.d3d12.1.613.2)
    add_subdirectory(winpixeventruntime.1.0.230302001)
    add_subdirectory(D3D12MemAlloc)
endif()

macro(get_all_targets_impl DIR TS)
    get_property(SUBDIRS DIRECTORY ${DIR} PROPERTY SUBDIRECTORIES)
    foreach(SUBDIR ${SUBDIRS})
        get_all_targets_impl(${SUBDIR} ${TS})
    endforeach()
    get_property(CTS DIRECTORY ${DIR} PROPERTY BUILDSYSTEM_TARGETS)
    list(APPEND ${TS} ${CTS})
endmacro()

function(get_all_targets OUT DIR)
    set(TS)
    get_all_targets_impl(${DIR} TS)
    set(${OUT} ${TS} PARENT_SCOPE)
endfunction()

set(RTRC_EXTERNAL_TARGETS)
get_all_targets(RTRC_EXTERNAL_TARGETS "${CMAKE_CURRENT_SOURCE_DIR}")

foreach(T ${RTRC_EXTERNAL_TARGETS})
    get_property(F TARGET ${T} PROPERTY FOLDER)
    set_property(TARGET ${T} PROPERTY FOLDER "Rtrc/External/${F}")
endforeach()
